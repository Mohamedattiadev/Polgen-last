<!DOCTYPE html>
<html>
	<head>
	<!-- Standard Meta -->
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<link rel="shortcut icon" type="image/png" href="assets/images/fav.png"/>
		<!-- Site Properties -->
		<title>Customer Page</title>
		<link rel="stylesheet" type="text/css" href="semantic.min.css">
		<link rel="stylesheet" type="text/css" href="jquery-ui.css">
		
		<link rel="stylesheet" type="text/css" href="css/customer.css">
		
		<script src="./jquery/jquery-3.3.1.js"></script>
		<script src="./jquery/jquery-plugins/js/jquery.cookie-1.4.1.js"></script>
		<script src="./jquery/jquery-plugins/js/jquery-ui.js"></script>
		<script src="./semanticui/semantic.min.js"></script>

		<script src="./acm/acm-ui-auth.js"></script>
		<script src="./acm/acm-data-handler.js"></script>
		<script src="./acm/acm-page-handler.js"></script>
		<script src="./acm/acm-input.js"></script>
		<script src="./acm/acm-form.js"></script>
		<script src="./acm/acm-link.js"></script>
		<script src="acm/acm-img.js"></script>
		<script src="acm/acm-dropdown.js"></script>
		<script src="acm/acm-container.js"></script>
		
		<script src="./js/moment-with-locales.js"></script>
		<script src="./acm/acm-xlsx.js"></script>
		<!--<script src="./js-xlsx/shim.js"></script>-->
		<script src="./js-xlsx/xlsx.full.min.js"></script>
		<script src="./js/FileSaver.js"></script>
		
		<style>
			.ui.label {
				width: 15%;
			}
		</style>
		
	</head>
	<body>
		<acmus id="navbarcontainer"></acmus>
		<acmus id="uploadcontainer"></acmus>
		<acmus id="registerformcontainer"></acmus>
	</body>
	<script>

	function sendForm() {
		var form = $.getWidget("container");
		form.semantic("validate form");
		if(form.semantic("is valid")) {
			$.formAction({name:"name",company:"company",mail:"mail",department:"department",door:"door",address:"address",phone:"phone"},"register",function(data){
				if(data.ok) {
					$(".ui.success.message").show();
				} else {
					form.semantic("add errors", [data.error]);
				}
			});
		}
	}
	
	$(document).on("pagecreated",function() {
		$('#excelupload').xlsx({
			fileupload: true,
			map: [
				{
					'dtOrigin': 'A11',
					'dtTitleRow': ['A20' ,'B20']
				},
				{
					'dtOrigin': 'A11',
					'dtTitleRow': ['A20' ,'B20']
				}
			],
			uploadfunc : function(inp) {

				$.getWidget("name").set(inp[0][1]);
				$.getWidget("company").set(inp[2][1]);
				$.getWidget("mail").set(inp[8][1]);
				$.getWidget("department").set(inp[3][1]);
				$.getWidget("door").set(inp[4][1]);
				$.getWidget("address").set(inp[5][1]);
				$.getWidget("phone").set(inp[7][1]);
			}
		});
	});

	
	$.ajax("/registerpage",{
		type: "POST",
		contentType:"application/json",
		dataType: "json",
		data: JSON.stringify({"pageid":"addCustomer"})
	}).done(function(data){
		$.createPage(data.page);
		//click button
		$("#registerbutton").click(function() {
			sendForm();
		});
		//press enter
		$('.input').keypress(function (e) {
		 if(e.which == 13) {// the enter key code
				sendForm();
				return false;  
			}
		});
	}).catch(function(err) {
		console.log(err);
	});
	
	</script>
<html>