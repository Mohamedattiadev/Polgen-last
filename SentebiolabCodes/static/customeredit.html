<!DOCTYPE html>
<html>

<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<link rel="shortcut icon" type="image/png" href="assets/images/fav.png" />
  <!-- Site Properties -->
  <title>Kargo Giri≈ü</title>


  <link rel="stylesheet" href="./jquery/jquery-plugins/css/jquery-ui.css">
  <link rel="stylesheet" href="./semanticui/semantic.min.css">
  <link rel="stylesheet" href="./datatables/datatables.min.css">
	<link rel="stylesheet" href="./css/general.css">
   
  <script src="./jquery/jquery-3.3.1.js"></script>
	<script src="./jquery/jquery-plugins/js/jquery-ui.js"></script>
	<script src="./jquery/jquery-plugins/js/jquery.cookie-1.4.1.js"></script>
	<script src="./semanticui/semantic.min.js"></script>
	<script src="./datatables/datatables.min.js"></script>

	<script src="./js/moment-with-locales.js"></script>
	<script src="./datatables/datetime.js"></script>
	<script src="./datatables/widgetbase.js"></script>

	<script src="./js-xlsx/xlsx.full.min.js"></script>
	<script src="./js/FileSaver.js"></script>

	<script src="acm/acm-ui-auth.js"></script>
	<script src="acm/acm-data-handler.js"></script>
	<script src="acm/acm-page-handler.js"></script>
	<script src="acm/acm-table.js"></script>
	<script src="acm/acm-xlsx.js"></script>
	<script src="acm/acm-file.js"></script>
	<script src="acm/acm-thumbnail.js"></script>
	<script src="acm/acm-modal.js"></script>
	<script src="acm/acm-dropdown.js"></script>
	<script src="acm/acm-container.js"></script>
	<script src="acm/acm-img.js"></script>
	<script src="acm/acm-link.js"></script>
	<script src="acm/acm-input.js"></script>
	<script src="acm/acm-dialog.js"></script>
	<script src="acm/acm-modal.js"></script>
	<script src="acm/acm-form.js"></script>
	
	
</head>

<body>
  <acmus id="navbarcontainer"></acmus>
  <acmus id="maincontainer"></acmus>
  
</body>

<script>
	
	function sendForm(userid) {
			var form = $.getWidget("container");
			form.semantic("validate form");
			if(form.semantic("is valid")) {
				$.formAction({name:"name",company:"company",mail:"mail",department:"department",door:"door",address:"address",phone:"phone","userid":userid},"updateTable",function(data){
					if(data.ok) {
						$(".ui.success.message").show();
					} else {
						form.semantic("add errors", [data.error]);
					}
				});
			}
		}

	var adminregisterinputs = [ "name","company","mail","department","door","address","phone"];

	$(document).on("pagecreated",function() {
		var customerid = $.cookie("customerid");
		if (customerid !== null) {
			adminregisterinputs.forEach(function(i){
				var tempwidg = $.getWidget(i);
				tempwidg.options.fetchparams.filter = {};
				tempwidg.options.fetchparams.filter.where = {};
				tempwidg.options.fetchparams.filter.where.userid = customerid;
				tempwidg.fetch("lazy");
			});
			
			var billtable = $.getWidget("billingtable");
			billtable.options.fetchparams.filter = {};
			billtable.options.fetchparams.filter.where = {};
			billtable.options.fetchparams.filter.where.userid = customerid;
			billtable.editor.on("preCreate",function ( e, type ) {
				console.log(e);
				console.log(type);
				type.data[0]["taxoffice"] = "customerid";
			});
			billtable.fetch("eager");
			// delete billtable.options.fetchparams.filter

			$("#updatebutton").click(function() {
				sendForm(customerid);
			});
			//press enter
			$('.input').keypress(function (e) {
				if(e.which == 13) {// the enter key code
					sendForm(customerid);
					return false;  
				}
			});



		}
	});

</script>
<html>