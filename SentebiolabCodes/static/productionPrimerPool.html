<!DOCTYPE html>
<html lang="tr">
	<head>
		<!-- Standard Meta -->
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<link rel="shortcut icon" type="image/png" href="assets/images/fav.png"/>
		<!-- Site Properties -->
		<title>Primer Havuzu</title>


		<link rel="stylesheet" href="./jquery/jquery-plugins/css/jquery-ui.css">
		<link rel="stylesheet" href="./semanticui/semantic.min.css">
		<link rel="stylesheet" href="./datatables/datatables.min.css">

		<script src="./jquery/jquery-3.3.1.js"></script>
		<script src="./jquery/jquery-plugins/js/jquery-ui.js"></script>
		<script src="./jquery/jquery-plugins/js/jquery.cookie-1.4.1.js"></script>
		<script src="./semanticui/semantic.min.js"></script>
		<script src="./datatables/datatables.min.js"></script>

		<script src="./js/moment-with-locales.js"></script>
		<script src="./datatables/datetime.js"></script>
		<script src="./datatables/widgetbase.js"></script>

		<script src="./js-xlsx/xlsx.full.min.js"></script>
		<script src="./js/FileSaver.js"></script>


		<script src="acm/acm-ui-auth.js"></script>
		<script src="acm/acm-data-handler.js"></script>
		<script src="acm/acm-page-handler.js"></script>
		<script src="acm/acm-dialog.js"></script>
		<script src="acm/acm-form.js"></script>
		<script src="acm/acm-input.js"></script>
		<script src="acm/acm-textarea.js"></script>
		<script src="acm/acm-table.js"></script>
		<script src="acm/acm-container.js"></script>
		<script src="acm/acm-img.js"></script>
		<script src="acm/acm-link.js"></script>
		<script src="acm/acm-dropdown.js"></script>
		<script src="acm/acm-cbox.js"></script>
		<script src="acm/acm-list.js"></script>
		<script src="acm/acm-modal.js"></script>
		<script src="acm/acm-xlsx.js"></script>
		<style>
			.content.container {
				margin-top:100px;
			}
			.redbp {
				background-color: #f1d7d7;
				color: #9f3a38;
			}
			div.absolute {
				position: absolute;
				top: 350px;
				left: 60px;
			}
			.fixeddiv{
				position: fixed !important;
				float: left;
				width: inherit;
				margin-top: 4em;
			}
			.sep{
				margin-bottom: 10px;
			}
		</style>
	</head>

	<body>

	<acmus id="navbarcontainer"></acmus>

	<div class="ui grid">
		<div class="one wide column"></div>
		<div class="three wide column">
			<div class="fixeddiv">
				<div class="ui card">
					<div class="content">
						<div class="header">Primerler:</div>
					</div>
					<div class="content">
						<div class="ui small feed">
							<div class="event">
								<div class="content">
									<div class="summary">
										 <p>
											 <strong>Seçilen:</strong>
											 <span id="secilen">0</span>
										 </p>
									</div>
								</div>
							</div>
							<div class="event">
								<div class="content">
									<div class="summary">
										 <p>
											 <strong>Sıradaki:</strong>
											 <span id="siradaki">0</span>
										 </p>
									</div>
								</div>
							</div>
							<div class="event">
								<div class="content">
									<div class="summary">
										 <p><strong>Filtrelenmiş:</strong><span id="filter">0</span></p>
									</div>
								</div>
							</div>
							<div class="event">
								<div class="content">
									<div class="summary">
										 <p><strong>Toplam:</strong><span id="total">0</span></p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="ui card">
					<div class="content">
						<div class= "sep">
							<span>Saflaştırma: </span>
							<div id="modpur"></div>
						</div>
						<div class= "sep">
							<span>Skala: </span>
							<div id="modmol"></div>
						</div>
						<div class= "sep">
							<div id="modprif"></div>
						</div>
						<div class= "sep">
							<div id="modprit"></div>
						</div>
						<div class= "sep">
							<div class="ui big grey fluid button" id="syntheses_button">Senteze Al</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="one wide column">
		</div>
		<div class="eleven wide column">
			<div class="ui vertically divided grid content container">
				<div class="row">
				  <div class="ui large header">
					<i class="snowflake outline icon"></i>
					<div class="content">
					  Primer Havuzu
					</div>
				  </div>
				</div>
				<div class="row">
				  <div class="column">
					<div id="primerpooltable"></div>
				  </div>
				</div>
				<div class="four column row">
				  <div id="button_container" class="left floated column"></div>
				  <div id="button2_container" class="right floated column"></div>
				</div>
			</div>
		</div>
	</div>
	<script>
		$(document).on("pagecreated", function(){
			$.getWidget('primerpooltable').datatable.on('draw.dt', function () {
				$("#total").html($.getWidget('primerpooltable').datatable.page.info().recordsTotal);
				$("#filter").html($.getWidget('primerpooltable').datatable.page.info().recordsDisplay);
			});

			$.formAction({ type: "primer"}, "synthService", function (res) {
				$("#siradaki").html(res.count);
			});

			$.getWidget('primerpooltable').datatable.on("select", function() {
				$("#secilen").html($.getWidget("primerpooltable").datatable.rows( { selected: true }).count());
			});

			$.getWidget('primerpooltable').datatable.on("deselect", function() {
				$("#secilen").html($.getWidget("primerpooltable").datatable.rows( { selected: true } ).count());
			});


			new $.fn.dataTable.Buttons($.getWidget('primerpooltable').table, {
				name: "export_control",
				buttons: [
					{ text: 'Excel', attr: { id: 'excel_download' } },
					{ extend: 'pdfHtml5' },
					{ extend: 'print', text: 'Yazdır' }
				]
			});

			// Place buttons to containers
			//$.getWidget('primerpooltable').table.DataTable().buttons(0, null).container().appendTo($('div.eight.column:eq(0)', $.getWidget('primerpooltable').table.DataTable().table().container()));
			$.getWidget('primerpooltable').table.DataTable().buttons(0, null).container().appendTo($('#button_container'));

			$("#modpur").ddown({
				oncreate: true,
				datasource: "ddserv1",
				div: "ui labeled selection fluid dropdown icon",
				header: [
					{ span: "text" },
					{ icon: "dropdown icon" }
				],
				semanticOptions: {
					onChange: function(value, text, $choice){
						var theCol = $.getWidget("primerpooltable").datatable.column(7);
						if(theCol.search() !== text && value !== 0) theCol.search(text).draw();
						else if(theCol.search() !== text && value === 0) theCol.search("").draw();
					}
				}
			});

			$("#modmol").ddown({
				oncreate: true,
				datasource: "ddserv1",
				div: "ui labeled selection fluid dropdown icon",
				header: [
					{ span: "text" },
					{ icon: "dropdown icon" }
				],
				semanticOptions: {
					onChange: function(value, text, $choice){
						var theCol = $.getWidget("primerpooltable").datatable.column(8);
						if(theCol.search() !== text && value !== 0) theCol.search(text).draw();
						else if(theCol.search() !== text && value === 0) theCol.search("").draw();
					}
				}
			});

			$("#modpur").ddown("set", [
				{
					id: 1,
					val: "HPLC"
				},
				{
					id: 2,
					val: "OPC"
				},
				{
					id: 3,
					val: "DSLT"
				},
				{
					id: 0,
					val: "Hepsi"
				}
			]);

			$("#modmol").ddown("set", [
				{
					id: 1,
					val: "50"
				},
				{
					id: 2,
					val: "100"
				},
				{
					id: 3,
					val: "200"
				},
				{
					id: 0,
					val: "Hepsi"
				}
			]);

			$("#modprif").cbox({
				label: "5' Modifiye Primerler",semanticOptions: {
					onChange: function() {

						var indexes = [];
						var colThird = $.getWidget("primerpooltable").datatable.column(3);
						if($(this).is(":checked")) {
							colThird.search("^\\s*(\\S+\\s*)+$", true, false).draw();
						} else {

							colThird.search("").draw();
						}

					}
				}
			});

			$("#modprit").cbox({
				label: "3' Modifiye Primerler",semanticOptions: {
					onChange: function() {
						var indexes = [];
						var colFifth = $.getWidget("primerpooltable").datatable.column(5);
						if($(this).is(":checked")) {
							colFifth.search("^\\s*(\\S+\\s*)+$", true, false).draw();
						} else {
							colFifth.search("").draw();
						}
					}
				}
			});

			$("#syntheses_button").click(function(){
				console.log($.getWidget("primerpooltable").datatable.rows({ selected: true } ).indexes());
				$.getWidget("primerpooltable").editor.edit($.getWidget("primerpooltable").datatable.rows({ selected: true } ).indexes(),false).set("synthid",0).submit(function(){
					//window.location.href = "productionSynthList.html";

					console.log("edit submit ok");
					$.getWidget("primerpooltable").datatable.rows( { selected: true } ).remove().draw();
					$("#secilen").html("0");
					$.formAction({ type: "primer"}, "synthService", function (res) {
						$("#siradaki").html(res.count);
					});
				}, function() {
					console.log("not ok");
					//handle error
				});
			});

		});

	</script>
</body>
</html>
