<!DOCTYPE html>
<html>

<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <link rel="shortcut icon" type="image/png" href="assets/images/fav.png" />
  <!-- Site Properties -->
  <title>Admin Sipariş Listesi</title>


  <link rel="stylesheet" href="./jquery/jquery-plugins/css/jquery-ui.css">
  <link rel="stylesheet" href="./semanticui/semantic.min.css">
  <link rel="stylesheet" href="./datatables/datatables.min.css">
	<link rel="stylesheet" href="./css/general.css">
   
  <script src="./jquery/jquery-3.3.1.js"></script>
	<script src="./jquery/jquery-plugins/js/jquery-ui.js"></script>
	<script src="./jquery/jquery-plugins/js/jquery.cookie-1.4.1.js"></script>
	<script src="./semanticui/semantic.min.js"></script>
	<script src="./datatables/datatables.min.js"></script>

	<script src="./js/moment-with-locales.js"></script>
	<script src="./datatables/datetime.js"></script>
	<script src="./datatables/widgetbase.js"></script>

	<script src="./js-xlsx/xlsx.full.min.js"></script>
	<script src="./js/FileSaver.js"></script>

	<script src="acm/acm-ui-auth.js"></script>
	<script src="acm/acm-data-handler.js"></script>
	<script src="acm/acm-page-handler.js"></script>
	<script src="acm/acm-table.js"></script>
	<script src="acm/acm-xlsx.js"></script>
	<script src="acm/acm-file.js"></script>
	<script src="acm/acm-thumbnail.js"></script>
	<script src="acm/acm-modal.js"></script>
	<script src="acm/acm-dropdown.js"></script>
	<script src="acm/acm-container.js"></script>
	<script src="acm/acm-img.js"></script>
	<script src="acm/acm-link.js"></script>

</head>

<body>

  <acmus id="navbarcontainer"></acmus>
  <acmus id="pagecontainer"></acmus>
  
</body>

<script>


	var firstcreate = true;

	$(document).on("pagecreated",function() {
		$.removeCookie("oid");
		if(firstcreate) {
			if ($.cookie("cid")) {
				var row = JSON.parse($.cookie("cid"));
				firstcreate = false;
				$.getWidget("orderlisttable").fetch('eager',[row]);
				//$.removeCookie("cid");
			} else {
				window.location.href = "/delivery.html";
			}
		}
	});

  var page = {
    widgets: {
	  container: {
			type: "container",
			selector: "#pagecontainer",
			options: {
				div: "below_navbar ui content container",
				structure: [
					{div: "ui vertically divided grid container", structure:[
						{div: "row",structure:[
							{div: "ui large header",structure:[
								{icon: "noclass", i:"clipboard outline icon"},
								{div:"content",html:"Eski Siparişler"}
							]}
						]},
						{div: "row",structure:[
							{div: "column", structure:[
								{div: "#orderlisttable"}
							]}
						]},
						{div: "row",structure:[
							{div:"eight wide colum #buttoncontainer"},
						]}
					]}
				]
			}
	  },
      orderlisttable: {
        type: "table",
        selector: "#orderlisttable",
        options: {
          datasource: "editorService",
          fetchparams: {
			table: "orders",
			columns: ["id","type","ordernum", "date", "productsnum", "completed","payment"],
			join: [
						{table:"users", foreign:"userid",target:"userid", columns : ["mail"]},
					],
			filter: {
				where : {
					orderdone: true
				}
			},
			order: ['orders.id DESC'],
			whereparams: ["userid"]
          },
          oncreate: false,
          table: "ui celled table",

          datatable: {
			order: [],
            columns: [
              //{ title: "Müşteri", data: "customer" },
			  {data:"id",visible:false, type:"hidden"},
              { title: "Sipariş No", data: "ordernum" ,render:
				function(data, type, row, meta) {
					var elm = $(document.createElement("a")).addClass("item").css('cursor', 'pointer').html(data);
					elm.click(function(){
						$.cookie("tempvar",JSON.stringify(row));
						window.location.href = "cargodetails.html";
					});
					$($("#" + meta.settings.sTableId).DataTable().cell(meta.row, meta.col).node()).empty().append(elm);
					return null;
				}
			  },
			  { title: "Tip",data : "type",render: "type"},
              { title: "Sipariş Tarihi", data: "date", render: "momentdate"},
              { title: "Ürün Sayısı", data: "productsnum" },
              {
                title: "Tamamlanma",
                data: "completed",
                render: function (data, type, row, meta) {
                  //var bar_color = (data === 0) ? 'red' : (data === 100) ? 'green' : 'yellow';
                  //return '<div class=\"progressbar ui progress ' + bar_color + '\" data-percent=\"' + data + '\"><div class=\"bar\"><div class=\"progress\"></div></div></div>';
				  return data ? "<div class='ui indicating inverted progress progressbar' data-percent='" + data * 100 + "'><div class='bar'><div class='progress'></div></div></div>" : "Beklemede";
                }
              },
			  //{ title: "Alınan Ödeme  <i class='pencil alternate icon' ></i>", data: "payment", name: "payment", render: "eur" },
			  /*
              {
                title: "Durum",
                data: "order_status",
                render: function (data, type, row, meta) {
                  if (data === 0) {
                    return '<a class="ui label" id="btn_' + row.id + '"><i class="right arrow icon"> </i>Fatura Yükle</a>';
                  } else if (data === 1) {
                    return '<div id="btn_' + row.id + '" class="ui label"><i class="thumbs up icon"></i> Fatura Mevcut</div>';
                  } else if (data === -1) {
                    return '<a class="ui label"><i class="thumbs down icon"></i> Tekrar Fatura Yükle</a>';
                  }
                }
              }*/
            ],
			lengthChange: true,
			responsive: true,
			select: false
			/*
            select: {
              style: 'os',
              className: 'active'
            },
			
            lengthChange: false,
            fixedHeader: true,
            responsive: true,
            pagingType: "full",
            "language": {
              processing: "Aranıyor...",
              info: "_PAGES_ Sayfadan _PAGE_. gösteriliyor",
              infoFiltered: " - _MAX_ satırdan filtrelendi",
              infoEmpty: "0 satır bulundu",
              infoPostFix: "",
              loadingRecords: "Kayıtlar yükleniyor...",
              zeroRecords: "Kayıt bulunamadı",
              emptyTable: "Tablo boş",
              lengthMenu: "_MENU_ kayıt göster.",
              search: "_INPUT_",
              searchPlaceholder: "Arama",
              select: {
                rows: "%d satır seçildi."
              }
            }
			*/
          },
		  /*
		  editor: {
			allowed: ["id","payment"],
			inline: {
				submit: "allIfChanged"
			},
			idSrc: 'id',
		  }*/
        }
      }
    },
    services: {
      tableService: {
        source: "ajax",
        url: "table",
      },
	  editorService: {
        source: "ajax",
        url: "editor",
      }
    },
	functions: {
		momentdate: (function(data){
			if(data == null) return "";
			moment.locale('tr');
			return moment(data).format('YY MM DD HH:mm');//moment(data).format('HH:mm D MMM YY');
		}).toString(),
		eur: (function (data) {
			return (data == null || data == 0 ? "0" + "<i class='icon euro sign'></i>" : data + "<i class='icon euro sign'></i>") ;
		}).toString(),
		type: (function (data, type, row) {
			if (data == "primer") {
				return "<div><i style='color: cornflowerblue;' class='snowflake outline icon'></i>Primer</div>";
			} else if (data == "probe") {
				return "<div><i style='color: orange;' class='star icon'></i>Probe</div>";
			} else if (data == "sequence") {
				return "<div><i style='color: green;' class='dna icon'></i>Sekans</div>";
			} else if (data == "gene") {
				return "<div><i style='color: red;' class='dna icon'></i>Gen</div>";
			} else {
				return data;
			}
		}).toString()
	}
  };

  $.createPage(page);

  
</script>
<html>