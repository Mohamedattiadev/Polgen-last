<!DOCTYPE html>
<html>

<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <link rel="shortcut icon" type="image/png" href="assets/images/fav.png"/>
  <!-- Site Properties -->
  <title>Kargo Sipariş Detaylar</title>


    <link rel="stylesheet" type="text/css" href="semantic.min.css">
    <link rel="stylesheet" type="text/css" href="jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="datatables/datatables.min.css">
    
    <script src="jquery-3.3.1min.js"></script>
    <script src="jquery-ui.js"></script>
    <script src="jquery.cookie-1.4.1.js"></script>
    <script src="semantic.min.js"></script>
    <script src="datatables/datatables.min.js"></script>

    <script src="acm/acm-dataholder.js"></script>
    <script src="acm/acm-ui-auth.js" ></script>
    <script src="acm/acm-data-handler.js"></script>
    <script src="acm/acm-page-handler.js"></script>
    <script src="acm/acm-dialog.js"></script>
    <script src="acm/acm-table.js"></script>
    <script src="acm/acm-container.js"></script>
    <script src="acm/acm-img.js"></script>
    <script src="acm/acm-link.js"></script>
    <script src="acm/acm-dropdown.js"></script>
    <script src="acm/acm-input.js"></script>
    <script src="acm/acm-two-col-card.js"></script>
    <script src="acm/acm-xlsx.js"></script>
    <script src="acm/acm-file.js"></script>
    <script src="acm/acm-thumbnail.js"></script>
    <script src="acm/acm-modal.js"></script>
	<script src="acm/acm-prompt.js"></script>
	<script src="acm/acm-textarea.js"></script>
    
    <script src="./js/moment-with-locales.js"></script>
    <script src="./datatables/datetime.js"></script>
    <script src="./datatables/widgetbase.js"></script>
    <script src="./js-xlsx/xlsx.full.min.js"></script>
    <script src="./js/FileSaver.js"></script>
		
    <style>
        .content.container {
            margin-top:100px;
        }
        .centertext {
            text-align: center;
        }
        .vertpad{
            padding-top: 1%;
            padding-bottom: 5%;
        }
		.tablecontent {
			cursor:pointer;
			color:#33E;
			text-decoration:underline;
		}
		.tablecontent:hover {
			text-decoration:none;
			text-shadow: 1px 1px 1px #555;
		}
		.ui.fullscreen.modal {
			position: static !important;
		}
		textarea {
			resize: none;
			width: 100%;
			overflow-x: scroll;
			overflow-y: scroll;
			overflow-wrap: unset;
			white-space: pre;
		}
		.modalform {
			padding : 10px;
		}
    </style>

	</head>

	<body>
 
		<acmus id="navbarcontainer"></acmus>
		<acmus id="maincontainer"></acmus>
		<acmus id="dialogcontainer"></acmus>

	</body>

	<script>

	$(document).on("pagecreated",function() {

		$($("#primerselect_table>thead>tr>th")[4]).append($("<input>").attr("type",'checkbox').on("change",function(e){
			if(e.target.checked) {
				$.getWidget("primerselect").datatable.rows().select();
			} else {
				$.getWidget("primerselect").datatable.rows().deselect();
			}
		}));
		$($("#probeselect_table>thead>tr>th")[4]).append($("<input>").attr("type",'checkbox').on("change",function(e){
			if(e.target.checked) {
				$.getWidget("probeselect").datatable.rows().select();
			} else {
				$.getWidget("probeselect").datatable.rows().deselect();
			}
		}));
		$($("#geneselect_table>thead>tr>th")[4]).append($("<input>").attr("type",'checkbox').on("change",function(e){
			if(e.target.checked) {
				$.getWidget("geneselect").datatable.rows().select();
			} else {
				$.getWidget("geneselect").datatable.rows().deselect();
			}
		}));
		$($("#seqselect_table>thead>tr>th")[4]).append($("<input>").attr("type",'checkbox').on("change",function(e){
			if(e.target.checked) {
				$.getWidget("seqselect").datatable.rows().select();
			} else {
				$.getWidget("seqselect").datatable.rows().deselect();
			}
		}));


		var mailService = {
			source: "ajax",
			url: "mailer"
		};
		$.Widget.registerService("mailService",mailService);

		if ($.cookie("tempvar")) {
			var row = JSON.parse($.cookie("tempvar"));
			if(row.type == "primer") {
				$("#modaltable").transition("fade");
				//$.getWidget("priceholder").fetch('eager',[row.userid]);
				$.getWidget("ordercard").fetch('lazy',[row.id]);
				$.getWidget("primercard").fetch('lazy',[row.id]);
				//$.getWidget("ordertotal").fetch('lazy',[row.id]);
				$.getWidget("primertable").fetch('eager',[row.id]);
			} else if(row.type == "probe") {
				$("#probetable").transition("fade");
				$.getWidget("ordercard").fetch('lazy',[row.id]);
				$.getWidget("primercard").fetch('lazy',[row.id]);
				//$.getWidget("customercard").fetch('lazy',[row2]);
				$.getWidget("probetable").fetch('eager',[row.id]);
			} else if(row.type == "sequence") {
				$("#seqtable").transition("fade");
				$.getWidget("ordercard").fetch('lazy',[row.id]);
				$.getWidget("primercard").fetch('lazy',[row.id]);
				//$.getWidget("customercard").fetch('eager',[row2]);
				$.getWidget("seqtable").fetch('eager',[row.id]);
			} else if(row.type == "gene") {
				$("#genetable").transition("fade");
				$.getWidget("ordercard").fetch('lazy',[row.id]);
				$.getWidget("primercard").fetch('lazy',[row.id]);
				//$.getWidget("customercard").fetch('eager',[row2]);
				$.getWidget("genetable").fetch('eager',[row.id]);
			}

			$('#sendmail').on("click", function (e) {
				$.getWidget("tracking").set("");
				$.getWidget("emailaddress").set(row.user.mail);
				$.getWidget("additional").set("");

				rowid = row.id;
				rowtype = row.type;
				ordernum = row.ordernum;
				orderdate = row.date;
				ordermail = row.user.mail;
				if(row.type == "primer") {
					var arr = []; arr.push(row.id);
					$.getWidget('modal').show(arr,["probeselect","seqselect","geneselect"]);
				} else if(row.type == "probe") {
					var arr = []; arr.push(row.id);
					$.getWidget('modal').show(arr,["primerselect","seqselect","geneselect"]);
				} else if(row.type == "sequence") {
					var arr = []; arr.push(row.id);
					$.getWidget('modal').show(arr,["primerselect","probeselect","geneselect"]);
				} else if(row.type == "gene") {
					var arr = []; arr.push(row.id);
					$.getWidget('modal').show(arr,["primerselect","probeselect","seqselect"]);
				}
					
			});


		} else {
			window.location.href = "/cargo.html";
		}
		
		$('#setTakip').on("click", function (e) {
			
			if ($.getWidget("emailaddress").get().length == 0)  {
				alert ("Email adresi boş !");
				return;
			}

			var tempno = $.getWidget("tracking").get();
			if(tempno.length) {
			
				var temporderid  = null;
				var itemidarr = [];
				var reqtype = "";
			
				if ($($.getWidget("primerselect").element).transition("is visible")) {
					reqtype = "primer";
					$.getWidget("primerselect").datatable.rows({ selected: true }).every(function(){
						temporderid = this.data()["orderid"];
						itemidarr.push(this.data()["id"]);
					});
					
				} else if ($($.getWidget("probeselect").element).transition("is visible")) {
					reqtype = "probe";
					$.getWidget("probeselect").datatable.rows({ selected: true }).every(function(){
						temporderid = this.data()["orderid"];
						itemidarr.push(this.data()["id"]);
					});
					
				} else if ($($.getWidget("seqselect").element).transition("is visible")) {
					reqtype = "sequence";
					$.getWidget("seqselect").datatable.rows({ selected: true }).every(function(){
						temporderid = this.data()["orderid"];
						itemidarr.push(this.data()["id"]);
					});			
			
				} else if ($($.getWidget("geneselect").element).transition("is visible")) {
					reqtype = "gene";
					$.getWidget("geneselect").datatable.rows({ selected: true }).every(function(){
						temporderid = this.data()["orderid"];
						itemidarr.push(this.data()["id"]);
					});			
			
				}
				
				if (itemidarr.length == 0) {
					alert("Herhangi bir oligo seçilmedi !!!");
					return;
				}

				$.formAction({tracking : "tracking",items : itemidarr ,orderid: temporderid,reqtype:reqtype },"trackingService",function(res){
					if (res.ok == "ok") {
					
						var items = [];
						var datatableid = "primerselect";
						if(rowtype == "probe") datatableid = "probeselect";
						else if(rowtype == "sequence") datatableid = "seqselect";
						else if(rowtype == "gene") datatableid = "geneselect";
						
						
						$.getWidget(datatableid).datatable.rows({selected:true}).data().each(function(v){
							items.push(v.id);
							//console.log(v);
						});

						//console.log(items);
						$.formAction({
							action: "autoMail", 
							id:rowid, 
							type:rowtype, 
							date: moment(orderdate).format('YYYY-MM-DD HH:mm'),
							ordernum:ordernum, 
							productsnum: items.length,
							email: $.getWidget("emailaddress").get(),
							mailtype:"cargo",
							trackid: tempno,
							items: items,
							extrainfo: $.getWidget("additional").get()
						},"mailService",function(res){
							$.getWidget('modal').hide();
						});
					
					} else {
						alert("DataBase hatası! Sayfayı Yenileyip Tekrar Deneyin!");
					}
				})
			}
			else {
				alert ("Takip numarası girilmedi !");
			}
		});

    });
	</script>
<html>